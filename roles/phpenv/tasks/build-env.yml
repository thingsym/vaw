---
- name: build environment
  package:
    name:
      - libxml2-devel
      - bison-devel
      - openssl-devel
      - libjpeg-devel
      - libpng-devel
      - libmcrypt-devel
      - readline-devel
      - libtidy-devel
      - libxslt-devel
      - re2c
      - sqlite
      - sqlite-devel
      - oniguruma
      - oniguruma-devel
      - ImageMagick
      - ImageMagick-devel
    state: latest

- block:
  - name: remove old libzip
    yum:
      name:
        - libzip
        - libzip-devel
      state: removed

  - name: remi repository installed (CentOS/RHEL 7)
    yum:
      name: https://rpms.remirepo.net/enterprise/remi-release-7.rpm

  - name: install libzip via remi for php7.4
    yum:
      name:
        - libzip-last
        - libzip-last-devel
      enablerepo: "remi"
      state: latest
  when:
    - php_version is match("^7")
